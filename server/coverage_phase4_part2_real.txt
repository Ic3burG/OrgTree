
> orgtree-server@1.0.0 test:coverage
> vitest run --coverage src/routes/members.test.ts src/routes/people.test.ts src/routes/search.test.ts


[1m[46m RUN [49m[22m [36mv4.0.17 [39m[90m/Users/ojdavis/Claude Code/OrgTree/server[39m
      [2mCoverage enabled with [22m[33mv8[39m

[90mstdout[2m | src/routes/people.test.ts
[22m[39m[dotenv@17.2.3] injecting env (3) from .env.test -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | src/routes/search.test.ts
[22m[39m[dotenv@17.2.3] injecting env (3) from .env.test -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | src/routes/members.test.ts
[22m[39m[dotenv@17.2.3] injecting env (3) from .env.test -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

 [32m‚úì[39m src/routes/search.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 30[2mms[22m[39m
 [32m‚úì[39m src/routes/people.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 44[2mms[22m[39m
 [32m‚úì[39m src/routes/members.test.ts [2m([22m[2m16 tests[22m[2m)[22m[32m 60[2mms[22m[39m

[2m Test Files [22m [1m[32m3 passed[39m[22m[90m (3)[39m
[2m      Tests [22m [1m[32m34 passed[39m[22m[90m (34)[39m
[2m   Start at [22m 13:39:42
[2m   Duration [22m 673ms[2m (transform 229ms, setup 113ms, import 585ms, tests 134ms, environment 0ms)[22m

[34m % [39m[2mCoverage report from [22m[33mv8[39m
-------------------|---------|----------|---------|---------|-------------------
File               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
-------------------|---------|----------|---------|---------|-------------------
All files          |    4.24 |     3.24 |    2.93 |    4.35 |                   
 src               |    0.79 |        0 |       0 |     0.8 |                   
  db-init.ts       |       0 |        0 |       0 |       0 | 10-101            
  db.ts            |       0 |        0 |     100 |       0 | 6-23              
  instrument.ts    |       0 |        0 |       0 |       0 | 4-61              
  sentry.ts        |       0 |      100 |       0 |       0 | 9-18              
  socket.ts        |    1.33 |        0 |       0 |    1.33 | 14-219            
 src/middleware    |   23.18 |    10.34 |      25 |   23.18 |                   
  auth.ts          |   55.17 |     37.5 |   66.66 |   55.17 | 34,41-56,63-88    
  csrf.ts          |       0 |        0 |       0 |       0 | 19-135            
  errorHandler.ts  |       0 |        0 |       0 |       0 | 16-35             
  metrics.ts       |       0 |        0 |       0 |       0 | 14-34             
 src/migrations    |       0 |        0 |       0 |       0 |                   
  index.ts         |       0 |        0 |       0 |       0 | 6-82              
  ...migrations.ts |       0 |        0 |       0 |       0 | 17-339            
 ...tions/versions |       0 |      100 |       0 |       0 |                   
  ...hancements.ts |       0 |      100 |       0 |       0 | 3-104             
  ...p-transfer.ts |       0 |      100 |       0 |       0 | 4-85              
 src/routes        |   10.07 |     9.03 |    9.85 |   10.29 |                   
  analytics.ts     |       0 |        0 |       0 |       0 | 9-81              
  audit.ts         |       0 |        0 |       0 |       0 | 12-105            
  auth.ts          |       0 |        0 |       0 |       0 | 21-428            
  backup.ts        |       0 |        0 |       0 |       0 | 13-281            
  bulk.ts          |       0 |        0 |       0 |       0 | 12-191            
  csrf.ts          |       0 |      100 |       0 |       0 | 4-49              
  custom-fields.ts |       0 |        0 |       0 |       0 | 19-158            
  debug.ts         |       0 |        0 |       0 |       0 | 4-14              
  departments.ts   |       0 |        0 |       0 |       0 | 18-156            
  ...ers-simple.ts |       0 |        0 |       0 |       0 | 7-111             
  ...org-owners.ts |       0 |        0 |       0 |       0 | 7-96              
  ...aintenance.ts |       0 |        0 |       0 |       0 | 12-174            
  geds-import.ts   |       0 |        0 |       0 |       0 | 22-339            
  geds.ts          |       0 |        0 |       0 |       0 | 6-61              
  import.ts        |       0 |        0 |       0 |       0 | 9-252             
  invitations.ts   |       0 |        0 |       0 |       0 | 13-118            
  members.ts       |   89.74 |     90.9 |     100 |   89.74 | ...85,124,164,265 
  metrics.ts       |       0 |      100 |       0 |       0 | 17-86             
  ...ship-check.ts |       0 |        0 |       0 |       0 | 7-70              
  organizations.ts |       0 |        0 |       0 |       0 | 16-317            
  ...-transfers.ts |       0 |        0 |       0 |       0 | 13-138            
  passkey.ts       |       0 |        0 |       0 |       0 | 20-237            
  people.ts        |   89.47 |    77.77 |     100 |   89.47 | ...81,127,169,202 
  public.ts        |       0 |        0 |       0 |       0 | 8-238             
  ...d-searches.ts |       0 |        0 |       0 |       0 | 10-70             
  search.ts        |   72.91 |    66.66 |     100 |   72.91 | 20-29,75,108-113  
  totp.ts          |       0 |        0 |       0 |       0 | 12-189            
  users.ts         |       0 |        0 |       0 |       0 | 17-217            
  version.ts       |       0 |      100 |       0 |       0 | 3-14              
 src/services      |       0 |        0 |       0 |       0 |                   
  ...cs.service.ts |       0 |        0 |       0 |       0 | 10-134            
  audit.service.ts |       0 |        0 |       0 |       0 | 22-391            
  auth.service.ts  |       0 |        0 |       0 |       0 | 15-450            
  ...up.service.ts |       0 |        0 |       0 |       0 | 7-247             
  bulk.service.ts  |       0 |        0 |       0 |       0 | 128-817           
  csrf.service.ts  |       0 |        0 |       0 |       0 | 26-111            
  ...ds.service.ts |       0 |        0 |       0 |       0 | 13-401            
  ...nt.service.ts |       0 |        0 |       0 |       0 | 13-423            
  email.service.ts |       0 |        0 |       0 |       0 | 4-249             
  ...ce.service.ts |       0 |        0 |       0 |       0 | 43-318            
  ...er.service.ts |       0 |        0 |       0 |       0 | 29-141            
  ...ad.service.ts |       0 |        0 |       0 |       0 | 11-226            
  ...er.service.ts |       0 |        0 |       0 |       0 | 4-290             
  ...on.service.ts |       0 |        0 |       0 |       0 | 11-405            
  ...er.service.ts |       0 |        0 |       0 |       0 | 72-590            
  ...or.service.ts |       0 |        0 |       0 |       0 | 12-114            
  ...cs.service.ts |       0 |        0 |       0 |       0 | 28-358            
  ...up.service.ts |       0 |        0 |       0 |       0 | 6-43              
  org.service.ts   |       0 |        0 |       0 |       0 | 65-262            
  ...er.service.ts |       0 |        0 |       0 |       0 | 73-957            
  ...ey.service.ts |       0 |        0 |       0 |       0 | 20-228            
  ...le.service.ts |       0 |        0 |       0 |       0 | 17-411            
  ...ch.service.ts |       0 |        0 |       0 |       0 | 101-1063          
  ...ts.service.ts |       0 |        0 |       0 |       0 | 32-240            
  totp.service.ts  |       0 |        0 |       0 |       0 | 17-130            
  ...er.service.ts |       0 |        0 |       0 |       0 | 11-27             
  users.service.ts |       0 |        0 |       0 |       0 | 6-445             
 src/test-helpers  |       0 |        0 |       0 |       0 |                   
  ...-db-schema.ts |       0 |        0 |       0 |       0 | 11-378            
 src/types         |       0 |        0 |       0 |       0 |                   
  analytics.ts     |       0 |        0 |       0 |       0 |                   
  global.d.ts      |       0 |        0 |       0 |       0 |                   
  index.ts         |       0 |        0 |       0 |       0 | 221-228           
  metrics.ts       |       0 |        0 |       0 |       0 |                   
 src/utils         |   14.28 |        0 |       0 |   14.28 |                   
  escape.ts        |       0 |        0 |       0 |       0 | 1-17              
  logger.ts        |   22.22 |        0 |       0 |   22.22 | 23-30,36-42       
-------------------|---------|----------|---------|---------|-------------------
