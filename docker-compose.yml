# Docker Compose for OrgTree development
# Usage: docker-compose up

services:
  # =============================================================================
  # Development environment - hot reload for both frontend and backend
  # =============================================================================
  app:
    build:
      context: .
      target: development
    ports:
      - '5173:5173' # Frontend (Vite)
      - '3001:3001' # Backend (Express)
    volumes:
      # Mount source code for hot reload
      - .:/app
      # Preserve node_modules from container
      - /app/node_modules
      - /app/server/node_modules
      # Persist SQLite database
      - orgtree-data:/app/server
    environment:
      - NODE_ENV=development
      - JWT_SECRET=docker-dev-secret-change-in-production
      - VITE_API_URL=http://localhost:3001
    command: >
      sh -c "
        npm run dev &
        cd server && npm run dev
      "
    healthcheck:
      test: ['CMD', 'wget', '--spider', '-q', 'http://localhost:3001/api/health']
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

volumes:
  orgtree-data:
    driver: local

# =============================================================================
# Production configuration (use: docker-compose -f docker-compose.yml -f docker-compose.prod.yml up)
# =============================================================================
# See docker-compose.prod.yml for production overrides
